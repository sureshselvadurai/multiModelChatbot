<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <title>Multimodal Chatbot</title>






    <script>
        // Function to handle the login redirection based on user type (Customer or Company)
        function handleSignIn() {
            // Get the selected user type

            const userType = document.querySelector('input[name="userType"]:checked').id;
            console.log("User Type Selected: ", userType);  // Log the user type (Customer/Company)
            if (userType==="customer"){
                document.cookie = `section=section3; path=/; max-age=31536000`;
                }
            if (userType==="company"){
                document.cookie = `section=section2; path=/; max-age=31536000`;
            }
        const baseUrl = "https://us-east-1fqkcpapz2.auth.us-east-1.amazoncognito.com/login";
        const clientId = "47u7rlvrb9add08pfvu5532f7o"; // App client ID
        const responseType = "code"; // We are using the authorization code flow
        const scope = "email+openid+phone"; // Scopes for the authentication
        const redirectUri = "http://localhost:63342/multiModelChatbot/frontend/trial.html?_ijt=me4agno4edmun0o2nuasknvr69&_ij_reload=RELOAD_ON_SAVE"; // Redirect URI after login

        // Construct the full URL for redirection
        const loginUrl = `${baseUrl}?client_id=${clientId}&response_type=${responseType}&scope=${scope}&redirect_uri=${(redirectUri)}`;

        // Redirect to the login URL
        window.location.href = loginUrl;

        }
      function logout() {
      document.cookie = "section=; path=/; max-age=0"; // Delete the cookie by setting its max-age to 0
      loadSection(); // Reload the page to reflect the cleared cookie
    }

    </script>

    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f4f9;
            color: #333;
        }
        header {
            background-color: #4CAF50;
            color: white;
            padding: 20px;
            text-align: center;
        }
        .container {
            max-width: 600px;
            margin: 40px auto;
            padding: 20px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        h2 {
            text-align: center;
        }
        .login-btn {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }
        .login-btn:hover {
            background-color: #45a049;
        }
        .description {
            text-align: center;
            margin: 20px 0;
            font-size: 18px;
        }
        .button-container {
            text-align: center;
            margin-top: 20px;
        }
        .button-container button {
            padding: 10px 20px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .button-container button:hover {
            background-color: #45a049;
        }









    /* Basic styling to differentiate sections */
    .section {
      display: none; /* Hide all sections by default */
      padding: 20px;
      border: 1px solid #ccc;
      margin-bottom: 20px;
    }
    #section1 {
      background-color: #f9f9f9;
    }
    #section2 {
      background-color: #e0f7fa;
    }
    #section3 {
      background-color: #f1f8e9;
    }
    .button-container {
      margin-top: 20px;
    }
    button {
      padding: 10px;
      margin: 5px;
      cursor: pointer;
    }








        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f8f9fc;
        }

        /* Sidebar Styles */
        .sidebar {
<!--            height: 100vh;-->
            background-color: #343a40;
            color: #fff;
        }

        .sidebar a {
            color: #adb5bd;
            display: block;
            padding: 10px 20px;
            text-decoration: none;
            transition: background-color 0.2s;
        }

        .sidebar a:hover {
            background-color: #495057;
        }

        .sidebar .active {
            background-color: #495057;
            font-weight: bold;
        }

        /* Dashboard Styles */
        .dashboard-header {
            margin-bottom: 30px;
        }

        .card {
            margin-bottom: 30px;
        }

        .status {
            margin-top: 15px;
        }
    </style>
</head>
<body>












  <!-- Section 1 -->
  <div id="section1" class="section">
    <header>
        <h1>Multimodal Chatbot</h1>
        <p>Provide your product details, and customers can interact with a chatbot for support.</p>
    </header>

    <div class="container">
        <h2>Login</h2>

        <!-- User Type Selection (Customer or Company) -->
        <div class="description">
            <label><input type="radio" name="userType" id="customer" checked> Customer</label>
            <label><input type="radio" name="userType" id="company"> Company</label>
        </div>

        <!-- Sign-In Button -->
        <div class="button-container">
            <button class="login-btn" onclick="handleSignIn()">Sign In with Cognito</button>
        </div>
    </div>
  </div>


























  <!-- Section 2 -->
  <div id="section2" class="section">

    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar -->
            <nav class="col-md-2 d-none d-md-block bg-dark sidebar">
                <div class="sidebar-sticky">
                    <h3 class="text-center mt-4 mb-4">MMChatbot</h3>
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link active" href="#upload-pdf">Upload PDFs</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#upload-images">Upload Images</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#model-training">Model Training</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#model-accuracy">Check Accuracy</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#deploy-model">Deploy Model</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#predict-image">Image Prediction</a>
                        </li>
                    </ul>
                    <footer class="text-center mt-auto">
                        <small class="text-muted">&copy; 2024 MMChatbot</small>
                    </footer>
                </div>
            </nav>

            <!-- Main Dashboard Content -->
            <main role="main" class="col-md-9 ml-sm-auto col-lg-10 px-md-4">
                <div class="dashboard-header">
                    <h1 class="h2 mt-4">Dashboard</h1>
                </div>

                <!-- Upload PDFs Card -->
                <div id="upload-pdf" class="card shadow-sm">
                    <div class="card-header">
                        <h5>Upload PDF Documents</h5>
                    </div>
                    <div class="card-body">
                        <div class="form-row">
                            <div class="col-md-8">
                                <input type="file" id="uploadPDFInput" class="form-control-file" webkitdirectory directory multiple>
                            </div>
                            <div class="col-md-4">
                                <button class="btn btn-primary btn-block" onclick="uploadPDFs()">Upload PDFs</button>
                            </div>
                        </div>
                        <div id="uploadPDFStatus" class="status alert alert-secondary mt-3" role="alert"></div>
                    </div>
                </div>

                <!-- Upload Images Card -->
                <div id="upload-images" class="card shadow-sm">
                    <div class="card-header">
                        <h5>Upload Image Files</h5>
                    </div>
                    <div class="card-body">
                        <div class="form-row">
                            <div class="col-md-8">
                                <input type="file" id="uploadInput" class="form-control-file" webkitdirectory directory multiple>
                            </div>
                            <div class="col-md-4">
                                <button class="btn btn-primary btn-block" onclick="uploadImages()">Upload Images</button>
                            </div>
                        </div>
                        <div id="uploadStatus" class="status alert alert-secondary mt-3" role="alert"></div>
                    </div>
                </div>

                <!-- Model Training Card -->
                <div id="model-training" class="card shadow-sm">
                    <div class="card-header">
                        <h5>Model Training</h5>
                    </div>
                    <div class="card-body">
                        <button class="btn btn-success" onclick="startTraining()">Start Model Training</button>
                    </div>
                </div>

                <!-- Check Model Accuracy Card -->
                <div id="model-accuracy" class="card shadow-sm">
                    <div class="card-header">
                        <h5>Check Model Accuracy</h5>
                    </div>
                    <div class="card-body">
                        <button class="btn btn-info mr-2" onclick="getModelAccuracy()">Get Accuracy</button>
                        <button class="btn btn-danger" onclick="stopRetrying()">Stop Checking</button>
                        <div id="accuracyStatus" class="status alert alert-secondary mt-3" role="alert"></div>
                    </div>
                </div>

                <!-- Deploy Model Card -->
                <div id="deploy-model" class="card shadow-sm">
                    <div class="card-header">
                        <h5>Deploy the Trained Model</h5>
                    </div>
                    <div class="card-body">
                        <button class="btn btn-warning" onclick="deployModel()">Deploy Model</button>
                        <div id="deployStatus" class="status alert alert-secondary mt-3" role="alert"></div>
                    </div>
                </div>

                <!-- Image Prediction Card -->
                <div id="predict-image" class="card shadow-sm">
                    <div class="card-header">
                        <h5>Predict Image</h5>
                    </div>
                    <div class="card-body">
                        <div class="form-row">
                            <div class="col-md-8">
                                <input type="file" id="predictInput" class="form-control-file" accept="image/*">
                            </div>
                            <div class="col-md-4">
                                <button class="btn btn-primary btn-block" onclick="predictImage()">Predict</button>
                            </div>
                        </div>
                        <div id="predictionResult" class="status alert alert-secondary mt-3" role="alert"></div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Bootstrap JS and dependencies -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>




    <script>
        // URLs for the API Gateway endpoints
        const uploadPdfUrl = ' https://t039lbcsrf.execute-api.us-east-1.amazonaws.com/default/uploadPdf';  // Replace with your actual endpoint URL
        const uploadUrl = 'https://admziesndc.execute-api.us-east-1.amazonaws.com/default/ImageUploadHandler';
        const predictUrl = 'https://todjiezyk8.execute-api.us-east-1.amazonaws.com/default/test';
        const trainModelUrl = 'https://4x1jaawwlg.execute-api.us-east-1.amazonaws.com/default/train_model';
        const getModelMetricsUrl = 'https://u9tuxm2uv6.execute-api.us-east-1.amazonaws.com/default/getModelMetrics';
        const deployModelUrl = 'https://fgfbfkcgsf.execute-api.us-east-1.amazonaws.com/default/deployModel';
        const uploadPredictUrl = ' https://63l1a5no21.execute-api.us-east-1.amazonaws.com/default/uploadPredictImage';
        const predictImageUrl = 'https://medy7b7k4f.execute-api.us-east-1.amazonaws.com/default/predictImage';
        let retryInterval = null;

        // Function to upload a PDF
        async function uploadPDFs() {
            const files = document.getElementById('uploadPDFInput').files;
            if (files.length === 0) {
                alert('Please select images to upload.');
                return;
            }

            document.getElementById('uploadPDFStatus').innerText = `Uploading ${files.length} PDFs...`;

            for (let i = 0; i < files.length; i++) {
                await uploadPDF(files[i], i + 1, files.length);
            }
        }


        async function uploadPDF(file, current, total) {
            const formData = new FormData();
            formData.append('image', file);

            try {
                const response = await fetch(uploadPdfUrl, {
                    method: 'POST',
                    body: formData
                });

                if (!response.ok) {
                    throw new Error('Failed to upload image');
                }

                const result = await response.json();
                document.getElementById('uploadPDFStatus').innerText = `PDF ${current} of ${total} uploaded.`;
            } catch (error) {
                console.error('Error uploading PDF:', error);
                alert('Failed to upload image.');
            }
        }

        // Existing functions for image upload, model training, etc.
        async function uploadImages() {
            const files = document.getElementById('uploadInput').files;
            if (files.length === 0) {
                alert('Please select images to upload.');
                return;
            }

            document.getElementById('uploadStatus').innerText = `Uploading ${files.length} images...`;

            for (let i = 0; i < files.length; i++) {
                await uploadImage(files[i], i + 1, files.length);
            }
        }

        // Function to upload a single image
        async function uploadImage(file, current, total) {
            const formData = new FormData();
            formData.append('image', file);

            try {
                const response = await fetch(uploadUrl, {
                    method: 'POST',
                    body: formData
                });

                if (!response.ok) {
                    throw new Error('Failed to upload image');
                }

                const result = await response.json();
                document.getElementById('uploadStatus').innerText = `Image ${current} of ${total} uploaded.`;
            } catch (error) {
                console.error('Error uploading image:', error);
                alert('Failed to upload image.');
            }
        }

        // Existing functions for starting model training, accuracy, etc.
        async function startTraining() {
            try {
                const response = await fetch(trainModelUrl, { method: 'POST' });

                if (!response.ok) {
                    throw new Error('Failed to start training');
                }

                const result = await response.json();
                alert('Model training started successfully.');
            } catch (error) {
                console.error('Error starting training:', error);
                alert('Failed to start training.');
            }
        }

        async function getModelAccuracy() {
            document.getElementById('accuracyStatus').innerText = 'Checking accuracy...';
            try {
                const response = await fetch(getModelMetricsUrl);

                if (response.ok) {
                    const data = await response.json();
                    const lastTrainAccuracy = parseFloat(data.last_train_accuracy);
                    const lastValidationAccuracy = parseFloat(data.last_validation_accuracy);

                    let accuracyMessage = `
                        Last Train Accuracy: ${lastTrainAccuracy.toFixed(2)}<br>
                        Last Validation Accuracy: ${lastValidationAccuracy.toFixed(2)}
                    `;

                    let color = '';

                    if (lastValidationAccuracy >= 0.80) {
                        color = 'green';
                    } else if (lastValidationAccuracy >= 0.50) {
                        color = 'yellow';
                    } else {
                        color = 'red';
                    }

                    document.getElementById('accuracyStatus').innerHTML = accuracyMessage;
                    document.getElementById('accuracyStatus').style.color = color;
                } else {
                    document.getElementById('accuracyStatus').innerText = 'Model doesnt exist, retrying in 2 minutes...';
                    retryInterval = setInterval(async () => {
                        const retryResponse = await fetch(getModelMetricsUrl);
                        if (retryResponse.ok) {
                            const data = await retryResponse.json();
                            const lastTrainAccuracy = parseFloat(data.last_train_accuracy);
                            const lastValidationAccuracy = parseFloat(data.last_validation_accuracy);

                            let accuracyMessage = `
                                Last Train Accuracy: ${lastTrainAccuracy.toFixed(2)}<br>
                                Last Validation Accuracy: ${lastValidationAccuracy.toFixed(2)}
                            `;

                            let color = '';

                            if (lastValidationAccuracy >= 0.80) {
                                color = 'green';
                            } else if (lastValidationAccuracy >= 0.50) {
                                color = 'yellow';
                            } else {
                                color = 'red';
                            }

                            document.getElementById('accuracyStatus').innerHTML = accuracyMessage;
                            document.getElementById('accuracyStatus').style.color = color;
                            clearInterval(retryInterval);
                        }
                    }, 120000); // Retry every 2 minutes
                }
            } catch (error) {
                console.error('Error getting model accuracy:', error);
                document.getElementById('accuracyStatus').innerText = 'Error fetching model accuracy.';
            }
        }

        function stopRetrying() {
            if (retryInterval) {
                clearInterval(retryInterval);
                document.getElementById('accuracyStatus').innerText = 'Stopped retrying model accuracy.';
            }
        }

        async function deployModel() {
            try {
                document.getElementById('deployStatus').innerText = 'Deploying model...';
                const response = await fetch(deployModelUrl, { method: 'POST' });

                if (response.ok) {
                    const result = await response.json();
                    document.getElementById('deployStatus').innerText = 'Model deployed successfully. Deployment ID: ' + result.deploymentId;
                    document.getElementById('deployStatus').style.color = 'green';
                } else {
                    throw new Error('Failed to deploy model');
                }
            } catch (error) {
                console.error('Error deploying model:', error);
                document.getElementById('deployStatus').innerText = 'Failed to deploy model.';
                document.getElementById('deployStatus').style.color = 'red';
            }
        }

        async function predictImage() {
            const file = document.getElementById('predictInput').files[0];
            if (!file) {
                alert('Please select an image to predict.');
                return;
            }

            const formData = new FormData();
            formData.append('image', file);

            try {
                const response = await fetch(uploadPredictUrl, { method: 'POST', body: formData });

                if (!response.ok) {
                    throw new Error('Prediction failed');
                }

                const responsep = await fetch(predictImageUrl, { method: 'POST' });

                if (!responsep.ok) {
                    throw new Error('Prediction failed');
                }

                const result = await responsep.json();

                let predictionText = 'Prediction: ';

                result.PredictionResult.forEach(item => {
                    predictionText += `${item.label} (Probability: ${item.probability}), `;
                });

                predictionText = predictionText.slice(0, -2);
                document.getElementById('predictionResult').innerText = predictionText;

            } catch (error) {
                console.error('Error predicting image:', error);
                alert('Failed to predict image.');
            }
        }
    </script>

  </div>

  <!-- Section 3 -->
  <div id="section3" class="section">
    <h2>Section 3</h2>
    <p>This is the content from section 3. Yet another piece of content.</p>
  </div>

  <!-- Buttons to simulate setting cookies -->
  <div class="button-container">
    <button onclick="setSectionCookie('section1')">Show Section 1</button>
    <button onclick="setSectionCookie('section2')">Show Section 2</button>
    <button onclick="setSectionCookie('section3')">Show Section 3</button>
  </div>
    <div class="button-container">
    <button onclick="logout()">Logout (Clear Cookie)</button>
  </div>


  <script>
    // Function to set the cookie
    function setSectionCookie(section) {
      console.log("Cookie changes to :",section)
      document.cookie = `section=${section}; path=/; max-age=31536000`; // cookie lasts for 1 year
       // Reload the page to reflect the cookie change
    }

    // Function to get the cookie value by name
    function getCookie(name) {
      const value = "; " + document.cookie;
      const parts = value.split("; " + name + "=");
      if (parts.length === 2) return parts.pop().split(";").shift();
      return null;
    }

    // Function to display the section based on the cookie value
    function loadSection() {
      const sectionToShow = getCookie('section'); // Read cookie value (e.g., 'section1', 'section2', or 'section3')

      // Hide all sections
      const sections = document.querySelectorAll('.section');
      sections.forEach(section => {
        section.style.display = 'none';
      });

      // Show the selected section
      if (sectionToShow) {
        const selectedSection = document.getElementById(sectionToShow);
        if (selectedSection) {
          selectedSection.style.display = 'block';
        }
      } else {
        // Default behavior if no cookie is set (e.g., show section1)
        document.getElementById('section1').style.display = 'block';
      }
    }

    // Call the loadSection function when the page loads
    window.onload = loadSection;
  </script>

</body>
</html>

http://localhost:63342/multiModelChatbot/frontend/trial.html?_ijt=qhgo1tvi5c5cno0go1dmd85agm&_ij_reload=RELOAD_ON_SAVE&code=da86bbd3-b720-4b6a-b645-96726eee5603
http://localhost:63342/multiModelChatbot/frontend/trial.html?_ijt=me4agno4edmun0o2nuasknvr69&_ij_reload=RELOAD_ON_SAVE
https://us-east-1fqkcpapz2.auth.us-east-1.amazoncognito.com/login?client_id=47u7rlvrb9add08pfvu5532f7o&response_type=code&scope=email+openid+phone&redirect_uri=http://localhost:63342/multiModelChatbot/frontend/trial.html?_ijt=me4agno4edmun0o2nuasknvr69&_ij_reload=RELOAD_ON_SAVE
https://us-east-1fqkcpapz2.auth.us-east-1.amazoncognito.com/login/continue?client_id=47u7rlvrb9add08pfvu5532f7o&redirect_uri=http%3A%2F%2Flocalhost%3A63342%2FmultiModelChatbot%2Ffrontend%2Ftrial.html%3F_ijt%3Dqhgo1tvi5c5cno0go1dmd85agm%26_ij_reload%3DRELOAD_ON_SAVE&response_type=code&scope=email+openid+phone


https://us-east-1fqkcpapz2.auth.us-east-1.amazoncognito.com/login?client_id=47u7rlvrb9add08pfvu5532f7&response_type=code&scope=email%20openid%20phone&redirect_uri=https%253A%252F%252Fd84l1y8p4kdic.cloudfront.net
https://us-east-1fqkcpapz2.auth.us-east-1.amazoncognito.com/login?client_id=47u7rlvrb9add08pfvu5532f7&response_type=code&scope=email+openid+phone&redirect_uri=https%3A%2F%2Fd84l1y8p4kdic.cloudfront.net
https://us-east-1fqkcpapz2.auth.us-east-1.amazoncognito.com/login?client_id=47u7rlvrb9add08pfvu5532f7o&response_type=code&scope=email+openid+phone&redirect_uri=https%3A%2F%2Fd84l1y8p4kdic.cloudfront.net